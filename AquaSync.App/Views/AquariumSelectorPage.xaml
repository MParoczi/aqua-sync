<Page
    x:Class="AquaSync.App.Views.AquariumSelectorPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:models="using:AquaSync.App.Models"
    xmlns:converters="using:AquaSync.App.Converters">

    <Page.Resources>
        <converters:NullToDefaultImageConverter x:Key="NullToDefaultImageConverter" />
        <converters:AquariumStatusToOpacityConverter x:Key="StatusToOpacityConverter" />
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibility" />
    </Page.Resources>

    <Grid Padding="32">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Page title -->
        <TextBlock
            Grid.Row="0"
            Text="My Aquariums"
            Style="{StaticResource TitleLargeTextBlockStyle}"
            Margin="0,0,0,24" />

        <!-- Loading indicator -->
        <ProgressRing
            Grid.Row="1"
            IsActive="{x:Bind ViewModel.IsLoading, Mode=OneWay}"
            Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay}"
            HorizontalAlignment="Center"
            VerticalAlignment="Center" />

        <!-- Empty state (FR-003) -->
        <StackPanel
            x:Name="EmptyStatePanel"
            Grid.Row="1"
            HorizontalAlignment="Center"
            VerticalAlignment="Center"
            Spacing="16"
            Visibility="Collapsed">

            <Image
                Source="ms-appx:///Assets/aquarium-default.png"
                Width="120"
                Height="120"
                HorizontalAlignment="Center"
                Opacity="0.6" />

            <TextBlock
                Text="No aquariums yet"
                Style="{StaticResource SubtitleTextBlockStyle}"
                HorizontalAlignment="Center"
                Foreground="{ThemeResource TextFillColorSecondaryBrush}" />

            <Button
                Content="Create your first aquarium"
                Style="{StaticResource AccentButtonStyle}"
                HorizontalAlignment="Center"
                Click="AddAquariumCard_Click" />
        </StackPanel>

        <!-- Aquarium grid (FR-001, FR-006) -->
        <GridView
            x:Name="AquariumGrid"
            Grid.Row="1"
            ItemsSource="{x:Bind ViewModel.Profiles, Mode=OneWay}"
            IsItemClickEnabled="True"
            ItemClick="AquariumGrid_ItemClick"
            SelectionMode="None"
            Visibility="Collapsed">

            <!-- "Add Aquarium" card in header â€” persistent entry point (FR-004) -->
            <GridView.Header>
                <Button
                    Width="244"
                    Height="284"
                    Margin="0,0,16,16"
                    Padding="0"
                    CornerRadius="8"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    BorderThickness="1"
                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    HorizontalContentAlignment="Center"
                    VerticalContentAlignment="Center"
                    Click="AddAquariumCard_Click">
                    <StackPanel
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Spacing="12">
                        <FontIcon
                            Glyph="&#xE710;"
                            FontFamily="{ThemeResource SymbolThemeFontFamily}"
                            FontSize="36"
                            Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}" />
                        <TextBlock
                            Text="Add Aquarium"
                            Style="{StaticResource BodyStrongTextBlockStyle}"
                            Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}" />
                    </StackPanel>
                </Button>
            </GridView.Header>

            <GridView.ItemsPanel>
                <ItemsPanelTemplate>
                    <ItemsWrapGrid
                        Orientation="Horizontal"
                        ItemWidth="260"
                        ItemHeight="300" />
                </ItemsPanelTemplate>
            </GridView.ItemsPanel>

            <!-- Profile card template (FR-002) -->
            <GridView.ItemTemplate>
                <DataTemplate x:DataType="models:Aquarium">
                    <Grid
                        Width="244"
                        Height="284"
                        CornerRadius="8"
                        Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                        BorderThickness="1"
                        Opacity="{x:Bind Status, Mode=OneWay, Converter={StaticResource StatusToOpacityConverter}}">

                        <!-- Context menu (FR-007) -->
                        <Grid.ContextFlyout>
                            <MenuFlyout Opening="CardMenuFlyout_Opening">
                                <MenuFlyoutItem
                                    Text="Archive"
                                    Tag="{x:Bind}"
                                    Click="ArchiveMenuItem_Click">
                                    <MenuFlyoutItem.Icon>
                                        <FontIcon Glyph="&#xE7B8;" />
                                    </MenuFlyoutItem.Icon>
                                </MenuFlyoutItem>
                                <MenuFlyoutItem
                                    Text="Restore"
                                    Tag="{x:Bind}"
                                    Click="RestoreMenuItem_Click">
                                    <MenuFlyoutItem.Icon>
                                        <FontIcon Glyph="&#xE777;" />
                                    </MenuFlyoutItem.Icon>
                                </MenuFlyoutItem>
                                <MenuFlyoutItem
                                    Text="Delete"
                                    Tag="{x:Bind}"
                                    Click="DeleteMenuItem_Click">
                                    <MenuFlyoutItem.Icon>
                                        <FontIcon Glyph="&#xE74D;" />
                                    </MenuFlyoutItem.Icon>
                                </MenuFlyoutItem>
                            </MenuFlyout>
                        </Grid.ContextFlyout>

                        <Grid.RowDefinitions>
                            <RowDefinition Height="140" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <!-- Thumbnail image -->
                        <Image
                            Grid.Row="0"
                            Source="{x:Bind ThumbnailPath, Mode=OneWay, Converter={StaticResource NullToDefaultImageConverter}}"
                            Stretch="UniformToFill" />

                        <!-- Card details -->
                        <StackPanel
                            Grid.Row="1"
                            Padding="12,8"
                            Spacing="2">
                            <TextBlock
                                Text="{x:Bind Name, Mode=OneWay}"
                                Style="{StaticResource BodyStrongTextBlockStyle}"
                                MaxLines="1"
                                TextTrimming="CharacterEllipsis" />
                            <TextBlock
                                Text="{x:Bind AquariumType, Mode=OneWay}"
                                Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                Style="{StaticResource CaptionTextBlockStyle}" />
                            <TextBlock
                                Text="{x:Bind VolumeDisplay, Mode=OneWay}"
                                Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                Style="{StaticResource CaptionTextBlockStyle}" />
                            <TextBlock
                                Text="{x:Bind SetupDateDisplay, Mode=OneWay}"
                                Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                                Style="{StaticResource CaptionTextBlockStyle}" />
                        </StackPanel>

                        <!-- Archived badge overlay (FR-029) -->
                        <Border
                            Grid.Row="0"
                            Background="{ThemeResource SystemFillColorCautionBackgroundBrush}"
                            CornerRadius="4"
                            Padding="8,4"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Top"
                            Margin="0,8,8,0"
                            Visibility="{x:Bind IsArchived, Mode=OneWay, Converter={StaticResource BoolToVisibility}}">
                            <TextBlock
                                Text="Archived"
                                Style="{StaticResource CaptionTextBlockStyle}"
                                FontWeight="SemiBold" />
                        </Border>
                    </Grid>
                </DataTemplate>
            </GridView.ItemTemplate>
        </GridView>
    </Grid>
</Page>
