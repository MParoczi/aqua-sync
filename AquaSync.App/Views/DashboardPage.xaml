<Page
  x:Class="AquaSync.App.Views.DashboardPage"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:vm="using:AquaSync.App.ViewModels"
  xmlns:converters="using:AquaSync.App.Converters">

  <Page.Resources>
    <converters:BoolToVisibilityConverter x:Key="BoolToVisibility" />
    <converters:StringNotEmptyToVisibilityConverter x:Key="StringNotEmptyToVisibility" />
  </Page.Resources>

  <ScrollViewer>
    <StackPanel Spacing="24" Padding="36,24">

      <TextBlock
        Text="Dashboard"
        Style="{StaticResource TitleTextBlockStyle}" />

      <!-- ═══ Lamps section ════════════════════════════════════════════════ -->

      <TextBlock
        Text="Lamps"
        Style="{StaticResource SubtitleTextBlockStyle}" />

      <!-- Empty state -->
      <TextBlock
        Text="No lamps assigned — go to Lamps to add one."
        Foreground="{ThemeResource TextFillColorSecondaryBrush}"
        Visibility="{x:Bind ViewModel.HasLamps, Mode=OneWay, Converter={StaticResource BoolToVisibility}, ConverterParameter=Inverse}" />

      <!-- Lamp cards -->
      <ItemsControl ItemsSource="{x:Bind ViewModel.LampCards, Mode=OneWay}">
        <ItemsControl.ItemTemplate>
          <DataTemplate x:DataType="vm:LampCardViewModel">
            <Border
              Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
              BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
              BorderThickness="1"
              CornerRadius="8"
              Padding="16,12"
              Margin="0,0,0,8">

              <Grid RowSpacing="12">
                <Grid.RowDefinitions>
                  <RowDefinition Height="Auto" />
                  <RowDefinition Height="Auto" />
                  <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <!-- Row 0: Identity -->
                <StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="8">
                  <TextBlock
                    Text="{x:Bind DisplayName}"
                    FontWeight="SemiBold" />
                  <TextBlock
                    Text="{x:Bind ModelName}"
                    Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                    Style="{StaticResource CaptionTextBlockStyle}"
                    VerticalAlignment="Center" />
                </StackPanel>

                <!-- Row 1: Mode selector + progress -->
                <Grid Grid.Row="1" ColumnSpacing="12">
                  <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                  </Grid.ColumnDefinitions>

                  <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="4">
                    <RadioButton
                      Content="Off"
                      GroupName="{x:Bind LampIdString}"
                      IsChecked="{x:Bind IsOffMode, Mode=OneWay}"
                      Command="{x:Bind SetModeCommand}"
                      CommandParameter="Off" />
                    <RadioButton
                      Content="Manual"
                      GroupName="{x:Bind LampIdString}"
                      IsChecked="{x:Bind IsManualMode, Mode=OneWay}"
                      Command="{x:Bind SetModeCommand}"
                      CommandParameter="Manual" />
                    <RadioButton
                      Content="Automatic"
                      GroupName="{x:Bind LampIdString}"
                      IsChecked="{x:Bind IsAutoMode, Mode=OneWay}"
                      Command="{x:Bind SetModeCommand}"
                      CommandParameter="Automatic" />
                  </StackPanel>

                  <ProgressRing
                    Grid.Column="1"
                    Width="20"
                    Height="20"
                    IsActive="{x:Bind IsConnecting, Mode=OneWay}"
                    VerticalAlignment="Center" />
                </Grid>

                <!-- Row 2: Error message (only when set) -->
                <TextBlock
                  Grid.Row="2"
                  Text="{x:Bind ErrorMessage, Mode=OneWay}"
                  Foreground="{ThemeResource SystemFillColorCriticalBrush}"
                  Style="{StaticResource CaptionTextBlockStyle}"
                  Visibility="{x:Bind ErrorMessage, Mode=OneWay, Converter={StaticResource StringNotEmptyToVisibility}}"
                  TextWrapping="Wrap" />

              </Grid>
            </Border>
          </DataTemplate>
        </ItemsControl.ItemTemplate>
      </ItemsControl>

    </StackPanel>
  </ScrollViewer>

</Page>
