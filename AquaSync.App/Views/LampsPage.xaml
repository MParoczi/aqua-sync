<Page
  x:Class="AquaSync.App.Views.LampsPage"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:models="using:AquaSync.App.Models"
  xmlns:converters="using:AquaSync.App.Converters">

  <Page.Resources>
    <converters:BoolToVisibilityConverter x:Key="BoolToVisibility" />
  </Page.Resources>

  <Grid Padding="36,24">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
      <RowDefinition Height="Auto" />
    </Grid.RowDefinitions>

    <!-- Row 0: Page header -->
    <Grid Grid.Row="0" Margin="0,0,0,16">
      <TextBlock
        Text="Lamps"
        Style="{StaticResource TitleTextBlockStyle}"
        VerticalAlignment="Center" />
      <Button
        HorizontalAlignment="Right"
        VerticalAlignment="Center"
        Click="AddButton_Click"
        ToolTipService.ToolTip="Add lamp">
        <FontIcon Glyph="&#xE710;" FontFamily="{ThemeResource SymbolThemeFontFamily}" />
      </Button>
    </Grid>

    <!-- Row 1: Content -->
    <Grid Grid.Row="1">

      <!-- Lamp list (visible when lamps exist) -->
      <ListView
        x:Name="LampsList"
        ItemsSource="{x:Bind ViewModel.Lamps, Mode=OneWay}"
        HorizontalContentAlignment="Stretch"
        SelectionMode="None"
        IsItemClickEnabled="True"
        ItemClick="LampsList_ItemClick"
        Visibility="{x:Bind ViewModel.IsEmpty, Mode=OneWay, Converter={StaticResource BoolToVisibility}, ConverterParameter=invert}">
        <ListView.ItemTemplate>
          <DataTemplate x:DataType="models:LampConfiguration">
            <Grid Padding="0,4" VerticalAlignment="Center">
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
              </Grid.ColumnDefinitions>

              <!-- Col 0: Model name + device name -->
              <StackPanel Grid.Column="0">
                <TextBlock Text="{x:Bind ModelName}" FontWeight="SemiLight" />
                <TextBlock
                  Text="{x:Bind DeviceName}"
                  Style="{StaticResource CaptionTextBlockStyle}"
                  Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                  TextTrimming="CharacterEllipsis" />
              </StackPanel>

              <!-- Col 1: Mode + connection state -->
              <StackPanel
                Grid.Column="1"
                HorizontalAlignment="Right"
                VerticalAlignment="Center"
                Spacing="2">
                <TextBlock Text="{x:Bind Mode}" HorizontalAlignment="Right" />
                <TextBlock
                  Text="Disconnected"
                  Style="{StaticResource CaptionTextBlockStyle}"
                  Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                  HorizontalAlignment="Right" />
              </StackPanel>

            </Grid>
          </DataTemplate>
        </ListView.ItemTemplate>
      </ListView>

      <!-- Empty state (visible when no lamps assigned) -->
      <StackPanel
        HorizontalAlignment="Center"
        VerticalAlignment="Center"
        Spacing="8"
        Visibility="{x:Bind ViewModel.IsEmpty, Mode=OneWay, Converter={StaticResource BoolToVisibility}}">
        <TextBlock
          Text="No lamps assigned. Tap + to add one."
          Foreground="{ThemeResource TextFillColorSecondaryBrush}"
          HorizontalAlignment="Center" />
      </StackPanel>

    </Grid>

    <!-- Row 2: Error InfoBar (for future error states) -->
    <InfoBar
      Grid.Row="2"
      x:Name="ErrorBar"
      Severity="Error"
      IsClosable="True" />

  </Grid>
</Page>
